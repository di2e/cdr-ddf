package net.di2e.ecdr.search.endpoint.rest;

import java.io.InputStream;

import org.apache.commons.io.IOUtils;
import org.apache.cxf.common.util.Base64Utility;
import org.apache.cxf.rs.security.saml.DeflateEncoderDecoder;

public class Test {

    private static final String saml = "<saml2:Assertion ID=\"_1CD44EC893C76A76EC1420937307184131\" IssueInstant=\"2015-01-11T00:48:27.184Z\" Version=\"2.0\" xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"saml2:AssertionType\"><saml2:Issuer>localhost</saml2:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><ds:Reference URI=\"#_1CD44EC893C76A76EC1420937307184131\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces PrefixList=\"xs\" xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue>gtqrYCm7bu6+LHqvOoc6bgQ7g7M=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>HCzvf16nfOnxjDJ4Pu+eButZ5+kL4k9WLtI7SuPM/sHTTrDOKZZXAitvEBt/QrldVxn7UhD2i09xIogAG+fPj/vWX/AHYkN+Xy9PYeIA1T/flkJVed2gCgbwDwQozc8cpriNAYAaEZY1/IfNXLiWEeNj1foUzOebF1h/RGfmD3o=</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIDEzCCAnygAwIBAgIJAIzc4FYrIp9mMA0GCSqGSIb3DQEBBQUAMHcxCzAJBgNVBAYTAlVTMQsw\nCQYDVQQIDAJBWjEMMAoGA1UECgwDRERGMQwwCgYDVQQLDANEZXYxGTAXBgNVBAMMEERERiBEZW1v\nIFJvb3QgQ0ExJDAiBgkqhkiG9w0BCQEWFWRkZnJvb3RjYUBleGFtcGxlLm9yZzAeFw0xNDEyMTAy\nMTU4MThaFw0xNTEyMTAyMTU4MThaMIGDMQswCQYDVQQGEwJVUzELMAkGA1UECAwCQVoxETAPBgNV\nBAcMCEdvb2R5ZWFyMQwwCgYDVQQKDANEREYxDDAKBgNVBAsMA0RldjESMBAGA1UEAwwJbG9jYWxo\nb3N0MSQwIgYJKoZIhvcNAQkBFhVsb2NhbGhvc3RAZXhhbXBsZS5vcmcwgZ8wDQYJKoZIhvcNAQEB\nBQADgY0AMIGJAoGBAMeCyNZbCTZphHQfB5g8FrgBq1RYzV7ikVw/pVGkz8gx3l3A99s8WtA4mRAe\nb6n0vTR9yNBOekW4nYOiEOq//YTi/frI1kz0QbEH1s2cI5nFButabD3PYGxUSuapbc+AS7+Pklr0\nTDI4MRzPPkkTp4wlORQ/a6CfVsNr/mVgL2CfAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAnBglghkgB\nhvhCAQ0EGhYYRk9SIFRFU1RJTkcgUFVSUE9TRSBPTkxZMB0GA1UdDgQWBBSA95QIMyBAHRsd0R4s\n7C3BreFrsDAfBgNVHSMEGDAWgBThVMeX3wrCv6lfeF47CyvkSBe9xjAgBgNVHREEGTAXgRVsb2Nh\nbGhvc3RAZXhhbXBsZS5vcmcwDQYJKoZIhvcNAQEFBQADgYEAtRUp7fAxU/E6JD2Kj/+CTWqu8Elx\n13S0TxoIqv3gMoBW0ehyzEKjJi0bb1gUxO7n1SmOESp5sE3jGTnh0GtYV0D219z/09n90cd/imAE\nhknJlayyd0SjpnaL9JUd8uYxJexy8TJ2sMhsGAZ6EMTZCfT9m07XduxjsmDz0hlSGV0=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml2:Subject><saml2:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\" NameQualifier=\"http://cxf.apache.org/sts\">FleeFlee</saml2:NameID><saml2:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:holder-of-key\"><saml2:SubjectConfirmationData xsi:type=\"saml2:KeyInfoConfirmationDataType\"><ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:X509Data><ds:X509Certificate>MIIDEzCCAnygAwIBAgIJAIzc4FYrIp9mMA0GCSqGSIb3DQEBBQUAMHcxCzAJBgNVBAYTAlVTMQsw\nCQYDVQQIDAJBWjEMMAoGA1UECgwDRERGMQwwCgYDVQQLDANEZXYxGTAXBgNVBAMMEERERiBEZW1v\nIFJvb3QgQ0ExJDAiBgkqhkiG9w0BCQEWFWRkZnJvb3RjYUBleGFtcGxlLm9yZzAeFw0xNDEyMTAy\nMTU4MThaFw0xNTEyMTAyMTU4MThaMIGDMQswCQYDVQQGEwJVUzELMAkGA1UECAwCQVoxETAPBgNV\nBAcMCEdvb2R5ZWFyMQwwCgYDVQQKDANEREYxDDAKBgNVBAsMA0RldjESMBAGA1UEAwwJbG9jYWxo\nb3N0MSQwIgYJKoZIhvcNAQkBFhVsb2NhbGhvc3RAZXhhbXBsZS5vcmcwgZ8wDQYJKoZIhvcNAQEB\nBQADgY0AMIGJAoGBAMeCyNZbCTZphHQfB5g8FrgBq1RYzV7ikVw/pVGkz8gx3l3A99s8WtA4mRAe\nb6n0vTR9yNBOekW4nYOiEOq//YTi/frI1kz0QbEH1s2cI5nFButabD3PYGxUSuapbc+AS7+Pklr0\nTDI4MRzPPkkTp4wlORQ/a6CfVsNr/mVgL2CfAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAnBglghkgB\nhvhCAQ0EGhYYRk9SIFRFU1RJTkcgUFVSUE9TRSBPTkxZMB0GA1UdDgQWBBSA95QIMyBAHRsd0R4s\n7C3BreFrsDAfBgNVHSMEGDAWgBThVMeX3wrCv6lfeF47CyvkSBe9xjAgBgNVHREEGTAXgRVsb2Nh\nbGhvc3RAZXhhbXBsZS5vcmcwDQYJKoZIhvcNAQEFBQADgYEAtRUp7fAxU/E6JD2Kj/+CTWqu8Elx\n13S0TxoIqv3gMoBW0ehyzEKjJi0bb1gUxO7n1SmOESp5sE3jGTnh0GtYV0D219z/09n90cd/imAE\nhknJlayyd0SjpnaL9JUd8uYxJexy8TJ2sMhsGAZ6EMTZCfT9m07XduxjsmDz0hlSGV0=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></saml2:SubjectConfirmationData></saml2:SubjectConfirmation></saml2:Subject><saml2:Conditions NotBefore=\"2015-01-11T00:48:27.187Z\" NotOnOrAfter=\"2015-01-11T01:18:27.187Z\"><saml2:AudienceRestriction><saml2:Audience>https://localhost:8993/services/SecurityTokenService?wsdl</saml2:Audience></saml2:AudienceRestriction></saml2:Conditions><saml2:AuthnStatement AuthnInstant=\"2015-01-11T00:48:27.185Z\"><saml2:AuthnContext><saml2:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified</saml2:AuthnContextClassRef></saml2:AuthnContext></saml2:AuthnStatement><saml2:AttributeStatement><saml2:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue xsi:type=\"xs:string\">blah</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue xsi:type=\"xs:string\">admin</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified\"><saml2:AttributeValue xsi:type=\"xs:string\">Jeff</saml2:AttributeValue></saml2:Attribute></saml2:AttributeStatement></saml2:Assertion>";

    public static void main( String args[] ) {
        try {
            byte[] cv = Base64Utility
                    .decode( "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" );
            DeflateEncoderDecoder decoder = new DeflateEncoderDecoder();
            InputStream is = decoder.inflateToken( cv );
            String tokenString = IOUtils.toString( is, "UTF-8" );
            // System.out.println( tokenString );

            byte[] deflated = decoder.deflateToken( tokenString.getBytes() );
            // System.out.println( IOUtils.toString( deflated, "UTF-8" ) );

            DeflateEncoderDecoder deflateEncoderDecoder = new DeflateEncoderDecoder();
            byte[] deflatedToken = deflateEncoderDecoder.deflateToken( saml.getBytes() );
            System.out.println( Base64Utility.encode( deflatedToken ) );
        } catch ( Exception e ) {
            e.printStackTrace();
        }
    }

}
